<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Admin-Scripts for Ubuntu</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Admin-Scripts for Ubuntu</h1>
          <h2>Scripts for simplified Ubuntu server administration.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/downloads/cederberg/admin-scripts/admin-scripts-0.2.zip" id="download-zip" class="button"><span>Download ZIP</span></a>
          <a href="https://github.com/downloads/cederberg/admin-scripts/admin-scripts-0.2.tgz" id="download-tar-gz" class="button"><span>Download TGZ</span></a>
          <a href="https://github.com/cederberg/admin-scripts" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">

<h2>Requirements</h2>

<ul>
<li>Ubuntu 12.04</li>
<li>Bash</li>
</ul>


<h2>Installation</h2>

<p>The install script will install required command-line tools and Perl modules.

<ol>
<li>Run install script (as root):<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<code>./install.sh</code></li>
<li>Copy &amp; modify config files from <code>etc</code>.</li>
</ol>


<h2 class="tool">admin-backup-files</h2>

<p>Performs a filesystem backup for configured directories.</p>

<p><strong>Syntax:</strong> <code>admin-backup-files [-v]</code></p>

<table>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
<tr>
<td>-v</td>
<td>Print verbose output.</td>
</tr>
</table>

<p>Configured in <code>/etc/admin-backup-files.conf</code> with one line
per directory to backup:</p>

<pre><code>/etc
/home
/root
/var/log   5
</code></pre>

<p>All the files in the directories specified will be recursively copied to a
new directory <code>/backup/&lt;hostname&gt;/files/&lt;timestamp&gt;</code>.
A symbolic link <code>/backup/&lt;hostname&gt;/files/latest</code> always points
to the last completed backup directory. An optional number after each directory
specifies the maximum number of days to store the files (differing from the
standard retention policy below).</p>

<p>In order to save space, identical files are hard linked between the current
and the previous backup directories. Only modified files (and the directory
structure) will require more space on the disk.</p>

<p>The first backup every month and day are created with a different timestamp
signature (omitting the hour and minute). The monthly backup directories are
kept indefinitely, but the daily directories are only preserved for 30 days.
Other timestamped backup directories will be preserved for 24 hours.</p>

<p>The file backup can be run as frequently as every minute, but should
probably be run at least once per day.</p>


<h2 class="tool">admin-backup-mysql</h2>

<p>Performs a MySQL dump of configured databases.</p>

<p><strong>Syntax:</strong> <code>admin-backup-mysql [-v]</code></p>

<table>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
<tr>
<td>-v</td>
<td>Print verbose output.</td>
</tr>
</table>

<p>Configured in <code>/etc/admin-backup-mysql.conf</code> with one line
per database to backup:</p>

<pre><code>database1 user password
database2 user password --ignore-table=table1
</code></pre>

<p>The <code>/backup/&lt;hostname&gt;/mysql/</code> directory is used to
store the output MySQL dump files (compressed). Backup files are
kept for 30 days, except the first backup file from each month
(which is kept indefinitely).</p>

<p>The MySQL backup should be run once per day. More frequent runs
will overwrite the previous backup.</p>


<h2 class="tool">admin-backup-sync</h2>

<p>Performs a remote file sync for configured directories.</p>

<p><strong>Syntax:</strong> <code>admin-backup-sync [-v]</code></p>

<table>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
<tr>
<td>-v</td>
<td>Print verbose output.</td>
</tr>
</table>

<p>Configured in <code>/etc/admin-backup-sync.conf</code> with one line
for each pair of source and destination directories:</p>

<pre><code>/backup/host01 root@host02:/backup/
root@host02:/backup/host02 /backup/
</code></pre>

<p>The file syncronization uses <code>rsync</code> and will update and
remove files on the receiving side, so be careful to sync the
correct backup subdirectories.</p>


<h2 class="tool">admin-freemem</h2>

<p>Cleans filesystem cache (if possible) to recover memory.</p>

<p><strong>Syntax:</strong> <code>admin-freemem</code></p>

<p>Forces a filesystem sync followed by a write
to <code>/proc/sys/vm/drop_caches</code>.</p>


<h2 class="tool">admin-restart</h2>

<p>Restarts a group of services in a predefined order.</p>

<p><strong>Syntax:</strong> <code>admin-restart [-q] &lt;group&gt;</code></p>

<table>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
<tr>
<td>-q</td>
<td>Quiet mode. Only prints errors to stderr.</td>
</tr>
</table>

<p>Configured in <code>/etc/admin-restart.conf</code> using shell script syntax
for defining each group with description, start and stop:</p>

<pre><code>group_web="Restart the Nginx and Jetty services"

start_web() {
    start jetty 10
    wget --quiet --spider localhost:8080 || fail "jetty not running"
    start nginx
}

stop_web() {
    stop nginx 10 force
    stop jetty 30 force
}
</code></pre>

<p>A number of built-in commands are available to simplify monitoring the
startup or shutdown of services:</p>

<table>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
<tr>
<td><code>start</code></td>
<td>Starts a service and optionally waits for the process to start.</td>
</tr>
<tr>
<td><code>stop</code></td>
<td>Stops a service and optionally waits for the process to quit.</td>
</tr>
<tr>
<td><code>alert</code></td>
<td>Prints a message to stderr.</td>
</tr>
<tr>
<td><code>fail</code></td>
<td>Exits and prints a message to stderr.</td>
</tr>
<tr>
<td><code>log</code></td>
<td>Prints a log message (if not in quiet mode).</td>
</tr>
</table>


<h2 class="tool">admin-status</h2>

<p>Checks the status of a number of services on the machine.</p>

<p><strong>Syntax:</strong> <code>admin-status</code></p>

<p>Configured in <code>/etc/admin-status.conf</code> with one line
per service (and PID file):</p>

<pre><code>cron    /var/run/crond.pid
sshd    /var/run/sshd.pid
</code></pre>


<h2 class="tool">admin-uptodate</h2>

<p>Runs a check to determine if the system requires updates.</p>

<p><strong>Syntax:</strong> <code>admin-uptodate [-s] [-m]</code>  </p>

<table>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
<tr>
<td>-s</td>
<td>Check only for security updates.</td>
</tr>
<tr>
<td>-m</td>
<td>Mail root instead of printing results.</td>
</tr>
</table>


<h2 class="tool">admin-utf8</h2>

<p>Converts a file or directory to UTF-8 (from ISO-8859-1). Only if needed.</p>

<p><strong>Syntax:</strong> <code>admin-utf8 (check|convert) &lt;file or dir&gt;</code></p>

<p>Use either <code>check</code> to detect file encoding, or <code>convert</code> to
convert all ISO-8859-1 file(s).</p>
        </section>

        <footer>
          Admin-Scripts for Ubuntu is maintained by <a href="https://github.com/cederberg">Per Cederberg</a><br>
          This page was adapted from 
          <a href="http://pages.github.com">GitHub Pages</a> with tactile theme
          by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
