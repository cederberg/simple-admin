<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Chivo:900">
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.2/css/smoothness/jquery-ui-1.10.2.custom.min.css">

    <!--[if IE 7]>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome-ie7.min.css">
    <![endif]-->
    <title>Simple-Admin Web Stats Viewer</title>
    <style type="text/css">

/* Default styles */
html {
    width: 100%;
    height: 100%;
}
body {
    width: -webkit-calc(100% - 40px);
    width: calc(100% - 40px);
    height: -webkit-calc(100% - 20px);
    height: calc(100% - 20px);
    overflow: hidden;
    margin: 0;
    padding: 10px 20px;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-size: 13px;
}
textarea {
    margin: 0;
    font-family: inherit;
    font-size: 100%;
}
select optgroup {
    font-family: inherit;
    font-size: inherit;
    font-style: inherit;
}

/* Header styles */
header h1 {
    margin: 0;
    padding: 0 0 5px 0;
    font-family: 'Chivo', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 900;
    letter-spacing: -1px;
    font-size: 3.0em;
    color: #303030;
    line-height: 1.2;
}
header h1 span {
    color: #888;
}

/* Loading styles */
#loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 100;
    -webkit-transition: opacity 0.7s ease;
    transition: opacity 0.7s ease;
}
#loading div {
    margin-top: 20%;
    text-align: center;
    font-size: 40px;
    color: white;
    text-shadow: 0 0 10px rgba(255,255,255,0.7);
    letter-spacing: 5px;
}
#loading i {
    display: inline-block;
    font-size: 500px;
    -webkit-animation: spin 10s linear 0s infinite;
    animation: spin 10s linear infinite;
}

/* Selector styles */
#selector {
    position: absolute;
    top: 22px;
    right: 20px;
}
#selector select {
    min-width: 20em;
    font-size: 1.1em;
    font-weight: bold;
}
#selector select * {
    font-weight: normal;
}
#selector optgroup:before {
    padding-left: 6px;
    color: #888;
}
#selector optgroup {
    margin-bottom: 6px;
    border-bottom: 1px solid #EEEEEE;
    padding-bottom: 6px;
}
#datepicker {
    position: absolute;
    top: 60px;
    right: 20px;
    z-index: 10;
    -webkit-transition: opacity 0.5s ease;
    transition: opacity 0.5s ease;
}

/* Summary styles */
#summary {
    margin: 5px 0 15px;
    border-radius: 6px;
    padding: 8px 10px;
    background: #666666;
    background: -moz-linear-gradient(top, #666666, #000000);
    background: -ms-linear-gradient(top, #666666, #000000);
    background: -webkit-linear-gradient(top, #666666, #000000);
    background: linear-gradient(top, #666666, #000000);
    color: white;
    box-shadow: 0 2px 4px #888;
    font-size: 1.2em;
}
#summary span {
    padding-left: 6px;
}

/* Tooltip styles */
#tooltip {
    position: absolute;
    max-width: 400px;
    z-index: 10;
    padding: 6px;
    border: 1px solid #888;
    border-radius: 4px;
    background: rgba(255,255,255,0.9);
    box-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    -webkit-transition: opacity 0.7s ease;
    transition: opacity 0.7s ease;
}

/* Chart Selector styles */
.chart-selector {
    height: 410px;
    overflow-x: auto;
    overflow-y: hidden;
    border-radius: 8px;
    padding: 0 0px;
    white-space: nowrap;
    background: #F8F8F8;
    box-shadow: 0 1px 3px #888 inset;
}
.chart-selector .box {
    position: relative;
    display: inline-block;
    width: 350px;
    height: 350px;
    overflow: hidden;
    margin: 20px 20px 20px 0;
    border-radius: 6px;
    padding: 5px;
    vertical-align: top;
    background: white;
    box-shadow: 0 0 3px #886;
}
.chart-selector .box h2 {
    margin: 3px 10px;
}
.chart-selector .box .barchart,
.chart-selector .box .piechart {
    height: 310px;
    overflow-x: hidden;
    overflow-y: auto;
}

/* Chart Selector styles */
.sortorder {
    position: absolute;
    top: 10px;
    right: 10px;
    color: #EEEEEE;
    font-size: 0.9em;
}
.sortorder span {
    color: #CCCCCC;
    cursor: pointer;
}
.sortorder span.selected {
    color: #666666;
}

/* Bar Chart styles */
.barchart {
    margin: 6px 0;
}
.barchart .row {
    margin: 0 0 5px 0;
    padding: 0 10px 4px 10px;
    border-radius: 4px;
    cursor: pointer;
    -webkit-transition: background 0.3s ease;
    transition: background 0.3s ease;
}
.barchart .row:hover {
    background: #F8F8F8;
}
.barchart .row.active {
    background: #F0F0F0;
}
.barchart .row.active,
.barchart .row.active .label {
    color: #000;
    text-shadow: 0.6px 0 0 #000;
}
.barchart.blue .row.active {
    background: #F0F8FF;
}
.barchart.red .row.active {
    background: #FFF0F0;
}
.barchart.green .row.active {
    background: #E8FFE8;
}
.barchart.cyan .row.active {
    background: #E8FCFF;
}
.barchart.purple .row.active {
    background: #F8F0FF;
}
.barchart.orange .row.active {
    background: #FFF4E0;
}
.barchart .label {
    float: left;
    max-width: -webkit-calc(100% - 100px);
    max-width: calc(100% - 100px);
    color: #666;
}
.barchart .value {
    float: right;
}
.barchart .bar {
    width: 100%;
    clear: both;
    height: 6px;
    margin: 0;
    border-radius: 3px;
    background: -moz-linear-gradient(left, #222, #ccc);
    background: -ms-linear-gradient(left, #222, #ccc);
    background: -webkit-linear-gradient(left, #222, #ccc);
    background: linear-gradient(left, #222, #ccc);
}
.barchart.blue .bar {
    background: -moz-linear-gradient(left, #2a4269, #38588e, #476fb2, #698bc3, #8da7d2, #b2c3e0);
    background: -ms-linear-gradient(left, #2a4269, #38588e, #476fb2, #698bc3, #8da7d2, #b2c3e0);
    background: -webkit-linear-gradient(left, #2a4269, #38588e, #476fb2, #698bc3, #8da7d2, #b2c3e0);
    background: linear-gradient(left, #2a4269, #38588e, #476fb2, #698bc3, #8da7d2, #b2c3e0);
}
.barchart.red .bar {
    background: -moz-linear-gradient(left, #6b1918, #942222, #be2c2b, #d54847, #df7170, #e89a9a);
    background: -ms-linear-gradient(left, #6b1918, #942222, #be2c2b, #d54847, #df7170, #e89a9a);
    background: -webkit-linear-gradient(left, #6b1918, #942222, #be2c2b, #d54847, #df7170, #e89a9a);
    background: linear-gradient(left, #6b1918, #942222, #be2c2b, #d54847, #df7170, #e89a9a);
}
.barchart.green .bar {
    background: -moz-linear-gradient(left, #4a661b, #688f25, #85b730, #9ed04a, #b4da73, #cae59b);
    background: -ms-linear-gradient(left, #4a661b, #688f25, #85b730, #9ed04a, #b4da73, #cae59b);
    background: -webkit-linear-gradient(left, #4a661b, #688f25, #85b730, #9ed04a, #b4da73, #cae59b);
    background: linear-gradient(left, #4a661b, #688f25, #85b730, #9ed04a, #b4da73, #cae59b);
}
.barchart.cyan .bar {
    background: -moz-linear-gradient(left, #165b6f, #1e7e9a, #26a1c5, #43b8db, #6ec9e3, #99d9eb);
    background: -ms-linear-gradient(left, #165b6f, #1e7e9a, #26a1c5, #43b8db, #6ec9e3, #99d9eb);
    background: -webkit-linear-gradient(left, #165b6f, #1e7e9a, #26a1c5, #43b8db, #6ec9e3, #99d9eb);
    background: linear-gradient(left, #165b6f, #1e7e9a, #26a1c5, #43b8db, #6ec9e3, #99d9eb);
}
.barchart.purple .bar {
    background: -moz-linear-gradient(left, #3f2954, #593977, #734a99, #8d63b3, #a685c4, #bfa7d5);
    background: -ms-linear-gradient(left, #3f2954, #593977, #734a99, #8d63b3, #a685c4, #bfa7d5);
    background: -webkit-linear-gradient(left, #3f2954, #593977, #734a99, #8d63b3, #a685c4, #bfa7d5);
    background: linear-gradient(left, #3f2954, #593977, #734a99, #8d63b3, #a685c4, #bfa7d5);
}
.barchart.orange .bar {
    background: -moz-linear-gradient(left, #9a5202, #cc6c03, #cc6c03, #fc9f39, #fdb86b, #fdd09e);
    background: -ms-linear-gradient(left, #9a5202, #cc6c03, #cc6c03, #fc9f39, #fdb86b, #fdd09e);
    background: -webkit-linear-gradient(left, #9a5202, #cc6c03, #cc6c03, #fc9f39, #fdb86b, #fdd09e);
    background: linear-gradient(left, #9a5202, #cc6c03, #cc6c03, #fc9f39, #fdb86b, #fdd09e);
}

/* Tab Switcher styles */
.tab-container {
    width: 100%;
    height: -webkit-calc(100% - 545px);
    height: calc(100% - 545px);
    margin: 20px 0 0 0;
}
.tab-label-list {
    position: relative;
    margin: 0;
}
.tab-label {
    display: inline-block;
    margin: 0 2px 0 0;
    border-width: 1px 1px 0;
    border-style: solid;
    border-color: #CCCCCC;
    border-radius: 6px 6px 0 0;
    padding: 3px 6px;
    background: #EEEEEE;
    background: -moz-linear-gradient(top , #FFFFFF, #DDDDDD);
    background: -ms-linear-gradient(top , #FFFFFF, #DDDDDD);
    background: -webkit-linear-gradient(top , #FFFFFF, #DDDDDD);
    background: linear-gradient(top , #FFFFFF, #DDDDDD);
    cursor: pointer;
    font-size: 1.1em;
    text-shadow: 0 1px 0 #FFFFFF;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
.tab-label.active {
    border-color: #888888;
    background: #88EEFF;
    color: #FFFFFF;
    text-shadow: 0 1px 1px #000000;
}
.tab-label.blue.active {
    border-color: #38588e;
    background: -moz-linear-gradient(bottom, #38588e, #476fb2, #698bc3, #8da7d2, #b2c3e0);
    background: -ms-linear-gradient(bottom, #38588e, #476fb2, #698bc3, #8da7d2, #b2c3e0);
    background: -webkit-linear-gradient(bottom, #38588e, #476fb2, #698bc3, #8da7d2, #b2c3e0);
    background: linear-gradient(bottom, #38588e, #476fb2, #698bc3, #8da7d2, #b2c3e0);
}
.tab-label.red.active {
    border-color: #942222;
    background: -moz-linear-gradient(bottom, #942222, #be2c2b, #d54847, #df7170, #e89a9a);
    background: -ms-linear-gradient(bottom, #942222, #be2c2b, #d54847, #df7170, #e89a9a);
    background: -webkit-linear-gradient(bottom, #942222, #be2c2b, #d54847, #df7170, #e89a9a);
    background: linear-gradient(bottom, #942222, #be2c2b, #d54847, #df7170, #e89a9a);
}
.tab-label.green.active {
    border-color: #688f25;
    background: -moz-linear-gradient(bottom, #688f25, #85b730, #9ed04a, #b4da73, #cae59b);
    background: -ms-linear-gradient(bottom, #688f25, #85b730, #9ed04a, #b4da73, #cae59b);
    background: -webkit-linear-gradient(bottom, #688f25, #85b730, #9ed04a, #b4da73, #cae59b);
    background: linear-gradient(bottom, #688f25, #85b730, #9ed04a, #b4da73, #cae59b);
}
.tab-label.cyan.active {
    border-color: #1e7e9a;
    background: -moz-linear-gradient(bottom, #1e7e9a, #26a1c5, #43b8db, #6ec9e3, #99d9eb);
    background: -ms-linear-gradient(bottom, #1e7e9a, #26a1c5, #43b8db, #6ec9e3, #99d9eb);
    background: -webkit-linear-gradient(bottom, #1e7e9a, #26a1c5, #43b8db, #6ec9e3, #99d9eb);
    background: linear-gradient(bottom, #1e7e9a, #26a1c5, #43b8db, #6ec9e3, #99d9eb);
}
.tab-label.purple.active {
    border-color: #593977;
    background: -moz-linear-gradient(bottom, #593977, #734a99, #8d63b3, #a685c4, #bfa7d5);
    background: -ms-linear-gradient(bottom, #593977, #734a99, #8d63b3, #a685c4, #bfa7d5);
    background: -webkit-linear-gradient(bottom, #593977, #734a99, #8d63b3, #a685c4, #bfa7d5);
    background: linear-gradient(bottom, #593977, #734a99, #8d63b3, #a685c4, #bfa7d5);
}
.tab-label.orange.active {
    border-color: #9a5202;
    background: -moz-linear-gradient(bottom, #9a5202, #cc6c03, #cc6c03, #fc9f39, #fdb86b, #fdd09e);
    background: -ms-linear-gradient(bottom, #9a5202, #cc6c03, #cc6c03, #fc9f39, #fdb86b, #fdd09e);
    background: -webkit-linear-gradient(bottom, #9a5202, #cc6c03, #cc6c03, #fc9f39, #fdb86b, #fdd09e);
    background: linear-gradient(bottom, #9a5202, #cc6c03, #cc6c03, #fc9f39, #fdb86b, #fdd09e);
}
.tab-content {
    width: -webkit-calc(100% - 20px);
    width: calc(100% - 20px);
    height: -webkit-calc(100% - 55px);
    height: calc(100% - 55px);
    margin: 0;
    border-radius: 0 6px 6px 6px;
    padding: 15px 10px;
    box-shadow: 0 1px 3px #886 inset;
}
.tab-content .barchart,
.tab-content .piechart {
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    overflow-y: auto;
    margin: 0;
}

/* Generic styles */
.compact th,
.compact td {
    padding: 0 3px 0 0;
}
.align-right {
    text-align: right;
}

.hidden {
    display: none;
}
.animation .hiding,
.animation .showing {
    opacity: 0;
}
.no-animation .hiding {
    display: none;
}
    </style>
  </head>

  <body>
    <header>
      <h1>Simple-Admin <span>Web Stats Viewer</span></h1>
    </header>

    <div id="loading">
      <div>
        <i class="icon-spinner"></i><br>
        <span>Loading Data...</span>
      </div>
    </div>

    <div id="selector">
      <select name="date">
        <optgroup label="Preset Dates">
          <option value="-1" selected>Yesterday</option>
          <option value="-2">Day Before Yesterday</option>
          <option value="-8">Last Week</option>
          <option value="-31">Last Month</option>
        </optgroup>
        <option value="...">Select Another Date...</option>
      </select>
    </div>
    <div id="datepicker" class="hidden hiding"></div>

    <div id="summary">
      <b>Total <span data-field="date" style="padding: 0;"></span>:</b>
      <span data-field="count" data-format="number"></span> requests,
      <span data-field="errors" data-format="number"></span> errors,
      <span data-field="kbytes" data-format="kbytes"></span> downloads,
      <span data-field="secs" data-format="secs"></span> processing time
    </div>

    <div id="tooltip" class="hidden hiding">
      <b><span data-field="name">Test</span>:</b>
      <table class="compact">
        <tbody>
          <tr>
            <td class="align-right"><span data-field="count" data-format="number"></span></td>
            <td>requests</td>
            <td>(<span data-field="count_ratio" data-format="percent"></span>)</td>
          </tr>
          <tr>
            <td class="align-right"><span data-field="errors" data-format="number"></span></td>
            <td>errors</td>
            <td>(<span data-field="errors_ratio" data-format="percent"></span>)</td>
          </tr>
          <tr>
            <td class="align-right"><span data-field="kbytes" data-format="kbytes/value"></span></td>
            <td><span data-field="kbytes" data-format="kbytes/unit"></span></td>
            <td>(<span data-field="kbytes_ratio" data-format="percent"></span>)</td>
          </tr>
          <tr>
            <td class="align-right"><span data-field="secs" data-format="secs/value"></span></td>
            <td><span data-field="secs" data-format="secs/unit"></span> total</td>
            <td>(<span data-field="secs_ratio" data-format="percent"></span>)</td>
          <tr>
            <td class="align-right"><span data-field="avgsecs" data-format="secs/value"></span></td>
            <td colspan="3"><span data-field="avgsecs" data-format="secs/unit"></span> / request</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="chart-selector">
      <div class="box" style="margin-left: 20px;">
        <h2>Host Names</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="host" class="barchart purple"></div>
      </div>
      <div class="box">
        <h2>File Types</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="file_type" class="piechart cyan"></div>
      </div>
      <div class="box">
        <h2>File Sources</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="file_source" class="barchart green"></div>
      </div>
      <div class="box">
        <h2>Referral Sites</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="top_referral_site" class="barchart orange"></div>
      </div>
      <div class="box">
        <h2>Countries</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="countries" class="piechart red"></div>
      </div>
      <div class="box">
        <h2>Time of Day</h2>
        <div class="sortorder">
          <span class="selected" data-sort="name/count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="name/kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="name/secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="time_of_day" class="barchart blue"></div>
      </div>
      <div class="box">
        <h2>Platforms</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="platforms" class="piechart purple"></div>
      </div>
      <div class="box">
        <h2>Browsers</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="browsers" class="piechart orange"></div>
      </div>
      <div class="box">
        <h2>Response Codes</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="http_code" class="barchart cyan"></div>
      </div>
      <div class="box">
        <h2>HTTP Versions</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="http_version" class="barchart green"></div>
      </div>
      <div class="box">
        <h2>HTTP Methods</h2>
        <div class="sortorder">
          <span class="selected" data-sort="-count"><i class="icon-sort-by-attributes-alt"></i> Reqs</span> |
          <span data-sort="-kbytes"><i class="icon-truck"></i> Size</span> |
          <span data-sort="-secs"><i class="icon-time"></i> Time</span>
        </div>
        <div id="http_method" class="barchart orange"></div>
      </div>
      <div class="box">
        <h2>Max Response Time</h2>
        <div id="process_time" class="barchart red"></div>
      </div>
    </div>

    <div class="tab-container">
      <div class="tab-label-list">
        <div class="tab-label cyan active" data-ref="top_request"><i class="icon-sort-by-attributes-alt"></i> Top Requests</div>
        <div class="tab-label purple" data-ref="top_download"><i class="icon-truck"></i> Top Downloads</div>
        <div class="tab-label orange" data-ref="top_process_time"><i class="icon-time"></i> Top Process Time</div>
        <div class="tab-label green" data-ref="top_redirect"><i class="icon-retweet"></i> Top Redirects</div>
        <div class="tab-label blue" data-ref="top_referral_source"><i class="icon-signout"></i> Referral Sources</div>
        <div class="tab-label cyan" data-ref="top_referral_target"><i class="icon-signin"></i> Referral Targets</div>
        <div class="tab-label red" data-ref="top_error"><i class="icon-bolt"></i> Errors</div>
      </div>
      <div class="tab-content">
        <div id="top_request" class="barchart cyan"></div>
      </div>
      <div class="tab-content hidden">
        <div id="top_download" class="barchart purple"></div>
      </div>
      <div class="tab-content hidden">
        <div id="top_process_time" class="barchart orange"></div>
      </div>
      <div class="tab-content hidden">
        <div id="top_redirect" class="barchart green"></div>
      </div>
      <div class="tab-content hidden">
        <div id="top_referral_source" class="barchart blue"></div>
      </div>
      <div class="tab-content hidden">
        <div id="top_referral_target" class="barchart cyan"></div>
      </div>
      <div class="tab-content hidden">
        <div id="top_error" class="barchart red"></div>
      </div>
    </div>


    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highcharts/3.0.2/highcharts.js"></script>
    <script type="text/javascript">

var BLUE = ['#2a4269', '#38588e', '#476fb2', '#698bc3', '#8da7d2', '#b2c3e0'];
var RED = ['#6b1918', '#942222', '#be2c2b', '#d54847', '#df7170', '#e89a9a'];
var GREEN = ['#4a661b', '#688f25', '#85b730', '#9ed04a', '#b4da73', '#cae59b'];
var CYAN = ['#165b6f', '#1e7e9a', '#26a1c5', '#43b8db', '#6ec9e3', '#99d9eb'];
var PURPLE = ['#3f2954', '#593977', '#734a99', '#8d63b3', '#a685c4', '#bfa7d5'];
var ORANGE = ['#9a5202', '#cc6c03', '#cc6c03', '#fc9f39', '#fdb86b', '#fdd09e'];

// Format a date
function formatDate(date) {
    var year = "" + date.getFullYear();
    var month = ("0" + (date.getMonth() + 1)).substr(-2);
    var day = ("0" + date.getDate()).substr(-2);
    return year + '-' + month + '-' + day;
}

// Format a numeric value
function formatNumber(num) {
    return Highcharts.numberFormat(num, 0);
}

// Format a numeric percent value
function formatPercent(num) {
    return Highcharts.numberFormat(num * 100, 1) + "%";
}

// Format a number of KB (data size)
function formatKb(kb) {
    if (kb < 1024) {
        return Highcharts.numberFormat(kb, 0) + " KB";
    } else if (kb < 1024 * 1024) {
        return Highcharts.numberFormat(kb / 1024, 2) + " MB";
    } else {
        return Highcharts.numberFormat(kb / (1024 * 1024), 2) + " GB";
    }
}

// Format a number of seconds (time)
function formatSecs(secs) {
    if (secs < 60) {
        return Highcharts.numberFormat(secs, 1) + " secs";
    } else if (secs < 3600) {
        return Highcharts.numberFormat(secs / 60, 1) + " mins";
    } else {
        return Highcharts.numberFormat(secs / 3600, 1) + " hrs";
    }
}

function formatTemplate(tmpl, data) {
    $(tmpl).find("span[data-field]").each(function () {
        var elem = $(this);
        var field = elem.attr("data-field");
        var fmt = elem.attr("data-format") || "text";
        var value = data[field];
        if (fmt == "number") {
            value = formatNumber(value);
        } else if (fmt == "percent") {
            value = formatPercent(value);
        } else if (fmt == "kbytes") {
            value = formatKb(value);
        } else if (fmt == "kbytes/value") {
            value = formatKb(value).replace(/\s\S*$/, "");
        } else if (fmt == "kbytes/unit") {
            value = formatKb(value).replace(/.*\s/, "");
        } else if (fmt == "secs") {
            value = formatSecs(value);
        } else if (fmt == "secs/value") {
            value = formatSecs(value).replace(/\s\S*$/, "");
        } else if (fmt == "secs/unit") {
            value = formatSecs(value).replace(/.*\s/, "");
        }
        $(this).text(value || "");
    });
}

function tooltipFormat(evt, data) {
    var tooltip = $("#tooltip");
    if (data && data !== tooltip.data("data")) {
        tooltip.data("data", data);
        formatTemplate("#tooltip", data);
    }
    if (evt && evt.pageX && evt.pageY) {
        var maxWidth = $("body").width();
        var maxHeight = $("body").height();
        var width = tooltip.width();
        var height = tooltip.height();
        var pos = { left: evt.pageX - 20, top: evt.pageY + 20 };
        pos.left = Math.max(0, Math.min(maxWidth - width, pos.left));
        if (pos.top + height >= maxHeight) {
            pos.top = evt.pageY - height - 30;
        }
        tooltip.css(pos);
    }
}

function tooltipShow() {
    clearTimeout($("#tooltip").data("timer"));
    $("#tooltip").data("timer", setTimeout(tooltipHide, 5000));
    show("#tooltip");
}

function tooltipHide() {
    hide("#tooltip");
}

function dataSeries(data, total, sort) {
    sort = sort || "-count";
    var m;
    var field = sort.replace(/.*\//, "").replace(/^\W+/, "");
    var sortKey = sort.replace(/^\W+/, "").replace(/\/.*/, "");
    var sortReverse = sort.charAt(0) == '-';
    var series = [];
    for (var k in data) {
        var v = data[k];
        if (v && v.count) {
            v.x = parseFloat(k);
            v.y = (typeof(v[field]) == "number") ? v[field] : v.count;
            v.name = k;
            v.count_ratio = v.count / total.count;
            v.errors_ratio = v.errors / total.errors;
            v.kbytes_ratio = v.kbytes / total.kbytes;
            v.secs_ratio = v.secs / total.secs;
            if (field == "kbytes") {
                v.value = formatKb(v.kbytes) + " (" +
                          formatPercent(v.kbytes_ratio) + ")";
            } else if (field == "secs") {
                v.value = formatSecs(v.secs) + " (" +
                          formatPercent(v.secs_ratio) + ")";
            } else if (field == "avgsecs") {
                v.value = formatSecs(v.avgsecs) + " (" +
                          formatNumber(v.count) + " requests)";
            } else {
                v.value = formatNumber(v.count) + " requests (" +
                          formatPercent(v.count_ratio) + ")";
            }
            series.push(v);
        }
    }
    series.sort(function (a, b) {
        var v1 = a[sortKey];
        var v2 = b[sortKey];
        var cmp = (v1 == v2) ? 0 : (v1 < v2) ? -1 : 1;
        return sortReverse ? -cmp : cmp;
    });
    return series;
}

function barChart(elem, data, total, sort) {
    var series = dataSeries(data, total, sort);
    var max = 0;
    for (var i = 0; i < series.length; i++) {
        max = Math.max(max, series[i].y);
    }
    var rows = [];
    for (var i = 0; i < series.length; i++) {
        var p = series[i];
        var label = $("<span class='label'/>").text(p.name);
        var value = $("<span class='value'/>").text(p.value);
        var pct = Math.round(Math.max(5, p.y * 100 / max));
        var bar = $("<div class='bar'/>").css("width", pct + "%");
        rows.push($("<div class='row'/>").append(label, value, bar).data(p));
    }
    $(elem).empty().append(rows);
}

function barChartSelect(evt) {
    var target = $(evt.target).closest(".row");
    target.parent().find(".active").removeClass("active");
    target.addClass("active");
    tooltipFormat(evt, target.data());
    tooltipShow();
}

function pieChart(elem, data, total, sort) {
    var series = dataSeries(data, total, sort);
    var elem = $(elem);
    var color = BLUE;
    if (elem.hasClass("red")) {
        color = RED;
    } else if (elem.hasClass("green")) {
        color = GREEN;
    } else if (elem.hasClass("cyan")) {
        color = CYAN;
    } else if (elem.hasClass("purple")) {
        color = PURPLE;
    } else if (elem.hasClass("orange")) {
        color = ORANGE;
    }
    var opts = {
        chart: { type: "pie" },
        title: { text: null },
        plotOptions: {
            pie: {
                colors: color,
                dataLabels: {
                    formatter: function () {
                        if (this.percentage < 2)
                            return null;
                        return this.point.name;
                    }
                },
                events: {
                    click: pieChartSelect
                }
            }
        },
        tooltip: {
            enabled: false
        },
        series: [{
            name: 'Requests',
            data: series
        }]
    }
    $(elem).highcharts(opts);
}

function pieChartSelect(evt) {
    tooltipFormat(evt, evt.point);
    tooltipShow();
}

function sortChart(evt) {
    var target = $(evt.target);
    if (!target.is("span")) {
        target = target.closest("span");
    }
    if (!target.is(".selected")) {
        target.parent().find(".selected").removeClass("selected");
        target.addClass("selected");
        renderChart(target.parents(".box").find(".barchart, .piechart"));
    }
    return false;
}

function renderChart(elem, data, total, sort) {
    elem = $(elem);
    data = data || elem.data("data");
    total = total || $("#summary").data("data");
    sort = sort || elem.parent().find(".sortorder .selected").attr("data-sort");
    elem.data("data", data);
    if (elem.hasClass("barchart")) {
        barChart(elem, data, total, sort);
    } else if (elem.hasClass("piechart")) {
        pieChart(elem, data, total, sort);
    }
}

function loadData() {
    var date = $("#selector select").val();
    if (date == "...") {
        show("#datepicker");
        return false;
    } else {
        show("#loading");
        $("#selector select").data("current", date);
        var file = "logstats." + date.replace(/-/g, "") + ".json";
        var cb = loadDataCb.bind(this, date);
        var eb = loadDataFail.bind(this, file);
        $.getJSON(file).then(cb, eb);
    }
}

function loadDataCb(date, res) {
    res.total.date = date;
    $("#summary").data("data", res.total);
    formatTemplate("#summary", res.total);
    renderChart("#host", res.host || [], res.total);
    renderChart("#file_type", res.file_type || [], res.total);
    renderChart("#file_source", res.file_source || [], res.total);
    renderChart("#top_referral_site", res.top_referral_site || [], res.total);
    renderChart("#countries", res.country || [], res.total);
    renderChart("#platforms", res.platform || [], res.total);
    renderChart("#browsers", res.browser || [], res.total);
    renderChart("#time_of_day", res.time_of_day || [], res.total, "name");
    renderChart("#http_version", res.http_version || [], res.total);
    renderChart("#http_method", res.http_method || [], res.total);
    renderChart("#http_code", res.http_code || [], res.total);
    renderChart("#process_time", res.process_time || [], res.total, "-x");
    renderChart("#top_request", res.top_request || [], res.total, "-count");
    renderChart("#top_download", res.top_download || [], res.total, "-kbytes");
    renderChart("#top_process_time", res.top_process_time || [], res.total, "-avgsecs");
    renderChart("#top_redirect", res.top_redirect || [], res.total, "-count");
    renderChart("#top_referral_source", res.top_referral_source || [], res.total, "-count");
    renderChart("#top_referral_target", res.top_referral_target || [], res.total, "-count");
    renderChart("#top_error", res.error || [], res.total, "-count");
    hide("#loading");
}

function loadDataFail(file, xhr, status, error) {
    hide("#loading");
    alert("Couldn't load file " + file + ":\n\n" + (error));
}

function selectDate(date) {
    hide("#datepicker");
    if (!date) {
        date = $("#selector select").data("current");
        $("#selector select").val(date);
    } else {
        var opt = $("#selector option[value='" + date + "']");
        if (!opt.length) {
             var dttm = $.datepicker.parseDate("yy-mm-dd", date);
             var txt = $.datepicker.formatDate("D, M dd yy (yy-mm-dd)", dttm);
             opt = $("<option value='" + date + "'/>").text(txt);
             if ($("#selector optgroup").length < 2) {
                 var grp = $("<optgroup label='Custom Dates'/>")
                 $("#selector option:last").before(grp);
             }
             $("#selector optgroup:last").append(opt);
        }
        $("#selector select").val(date).change();
    }
}

function selectTab(evt) {
    var target = $(evt.target);
    if (!target.is(".tab-label")) {
        target = target.closest(".tab-label");
    }
    if (!target.is(".active")) {
        target.parent().find(".active").removeClass("active");
        target.addClass("active");
        $(".tab-content").addClass("hidden");
        $("#" + target.attr("data-ref")).closest(".tab-content").removeClass("hidden");
    }
    return false;
}

function show(elem) {
    elem = $(elem);
    if (elem.hasClass("hidden") || elem.hasClass("hiding")) {
        elem.addClass("showing");
        elem.removeClass("hidden hiding");
        setTimeout(function () { elem.removeClass("showing"); }, 10);
    }
}

function hide(elem) {
    $(elem).addClass("hiding");
    setTimeout(function () {
        if ($(elem).hasClass("hiding")) {
            $(elem).addClass("hidden");
        }
    }, 1000);
}

$(function () {
    // Init animations
    var bodyStyles = document.body.style;
    if ("transition" in bodyStyles || "-webkit-transition" in bodyStyles) {
        $("body").addClass("animation");
    } else {
        $("body").addClass("no-animation");
    }

    // Init HighCharts
    Highcharts.setOptions({
        lang: { thousandsSep: " " }
    });

    // Init date selector
    $("#selector").find("option").each(function () {
        var opt = $(this);
        var val = opt.attr("value");
        if (/^[+-]\d+$/.test(val)) {
            var now = new Date().getTime();
            var date = formatDate(new Date(now + 24 * 60 * 60 * 1000 * val));
            opt.attr("value", date);
            opt.append(" (" + date + ")");
        }
    });
    $("#datepicker").datepicker({ numberOfMonths: 2, showWeek: true,
                                  maxDate: "-1D", dateFormat: "yy-mm-dd",
                                  onSelect: selectDate });

    // Init event handlers
    $("#selector select").on("click", false);
    $("#selector select").on("change", loadData);
    $(window).on("click", selectDate.bind(null, null));
    $("body").on("click touchstart", ".sortorder span", sortChart);
    $("body").on("click touchstart", ".tab-label", selectTab);
    $("body").on("click touchstart", ".barchart .row", barChartSelect);
    $("body").on("click touchstart mousemove", "#tooltip", tooltipShow);

    // Load initial data
    loadData();
});
    </script>
  </body>
</html>
